#!/bin/sh
# Get battery

string="BAT"
urgency_threshold="20"

get_battery() {
    path="/sys/class/power_supply/BAT0"
    if [ -d "$path" ]; then
        capacity=$(cat "$path/capacity")

        case "$(cat "$path/status")" in
            Discharging)
                # No special status
                status=""
                ;;
            Charging)
                status="(ch)"
                ;;
            Full)
                status="(full)"
                ;;
            *)
                status="(?)"
                ;;
        esac

        # Send notification on low battery.
        [ "$capacity" -le "$urgency_threshold" ] \
            && notify-send -u critical "Low Battery"

        if [ -n "$status" ]; then
            printf "%s %s %s %%\n" "$string" "$status" "$capacity"
        else
            printf "%s %s %%\n" "$string" "$capacity"
        fi
    fi
}

get_battery
